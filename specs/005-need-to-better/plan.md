# Implementation Plan: Enhanced Trip Data Model & Itinerary Management

**Branch**: `005-need-to-better` | **Date**: 2025-10-11 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/005-need-to-better/spec.md`

**Note**: This plan was generated by the `/speckit.plan` command following the workflow defined in `.specify/memory/constitution.md`.

## Summary

**Primary Requirement**: Extend the trip data model to support comprehensive travel logistics including flights, hotels, daily activities with precise timing, and restaurant recommendations, all organized chronologically while maintaining flexibility with optional elements.

**Technical Approach**: Expand existing TypeScript interfaces to add Flight, Hotel, DailyActivity, and RestaurantRecommendation entities with optional fields. Implement timezone-aware datetime handling using JavaScript Date objects with timezone identifiers. Store each trip in a separate JSON file (migrating from centralized trips.json). Create chronological sorting logic that respects timestamps and order_index for same-day items. Update UI components to display timeline view with conditional rendering for optional elements.

## Technical Context

**Language/Version**: TypeScript 5.x (strict mode), JavaScript ES2020+  
**Primary Dependencies**: Next.js 15.5.4, React 19.1.0, DaisyUI 5.2.0, Tailwind CSS 4.1.14  
**Storage**: JSON files (one per trip) in `/frontend/data/trips/` directory, migrating from single `trips.json`  
**Testing**: Next.js built-in testing (Jest + React Testing Library recommended)  
**Target Platform**: Web browsers (desktop + mobile responsive), Next.js App Router  
**Project Type**: Web application (frontend only, no backend changes)  
**Performance Goals**: <3 seconds page load (SC-001), smooth rendering with 50+ activities per trip (SC-007)  
**Constraints**: Offline-first architecture (constitution), must maintain existing trip list functionality, timezone-aware date/time handling required  
**Scale/Scope**: Single-page application update, ~7 new TypeScript interfaces, ~5 React components to update, data migration utility needed

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### âœ… Principle I: Offline-First Architecture
**Status**: PASS  
**Rationale**: Feature extends local JSON file storage. No network dependencies introduced. All data operations remain local-first.

### âœ… Principle II: Privacy-Friendly Design
**Status**: PASS  
**Rationale**: Plus Codes maintained for location data (FR-013). No tracking added. All data remains user-controlled in local files.

### âœ… Principle III: Minimalist User Experience
**Status**: PASS  
**Rationale**: Feature adds chronological timeline view which simplifies trip viewing (core user need from spec). Optional fields prevent UI clutter when data absent.

### âœ… Principle IV: Component-Driven Development
**Status**: PASS  
**Rationale**: Updates existing components (TripCard, TripDetails, PlaceCard) following established patterns. New timeline components will be reusable and self-contained.

### âœ… Principle V: Sync Integrity & Conflict Resolution
**Status**: PASS  
**Rationale**: Maintains UUID + updated_at pattern for all new entities. Structure supports future Supabase sync (deferred to separate feature).

### âœ… Principle VI: Code Simplicity Over Defensive Programming
**Status**: PASS  
**Rationale**: TypeScript interfaces with optional fields provide type safety without excessive validation. Chronological sorting uses simple timestamp comparison.

### ðŸ” Technology Constraints Check
- âœ… **Frontend Stack**: React + TypeScript + Next.js (using existing stack)
- âœ… **UI Framework**: DaisyUI + Tailwind CSS (using existing)
- âœ… **Local Storage**: JSON files (aligned with current approach, IndexedDB migration deferred)
- âœ… **Location Data**: Plus Codes (maintained in FR-013)
- N/A **Backend**: No backend changes
- N/A **State Management**: Simple prop drilling sufficient for this feature

**Gate Result**: âœ… PASS - All principles satisfied, no violations to justify

## Project Structure

### Documentation (this feature)

```text
specs/005-need-to-better/
â”œâ”€â”€ plan.md              # This file (speckit.plan output)
â”œâ”€â”€ research.md          # Phase 0: Technology decisions & patterns
â”œâ”€â”€ data-model.md        # Phase 1: Entity schemas & relationships
â”œâ”€â”€ quickstart.md        # Phase 1: Developer setup & examples
â”œâ”€â”€ contracts/           # Phase 1: TypeScript interfaces
â”‚   â””â”€â”€ interfaces.ts    # Complete type definitions
â””â”€â”€ tasks.md             # Phase 2: Implementation checklist (speckit.tasks)
```

### Source Code (repository root)

```text
frontend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ trip/
â”‚   â”‚   â””â”€â”€ [tripId]/
â”‚   â”‚       â””â”€â”€ page.tsx              # UPDATE: Timeline view implementation
â”‚   â””â”€â”€ page.tsx                       # UPDATE: Trip list with new data loading
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ TripCard.tsx                  # UPDATE: Preview new trip elements
â”‚   â”œâ”€â”€ TripDetails.tsx               # UPDATE: Full timeline display
â”‚   â”œâ”€â”€ TripTimeline.tsx              # NEW: Chronological item list
â”‚   â”œâ”€â”€ FlightCard.tsx                # NEW: Flight display component
â”‚   â”œâ”€â”€ HotelCard.tsx                 # NEW: Hotel display component  
â”‚   â”œâ”€â”€ ActivityCard.tsx              # NEW: Activity display component
â”‚   â””â”€â”€ RestaurantList.tsx            # NEW: Restaurant recommendations
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                      # UPDATE: Add Flight, Hotel, Activity, Restaurant interfaces
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ utils.ts                      # UPDATE: Add chronological sorting logic
â”‚   â”œâ”€â”€ dateTime.ts                   # NEW: Timezone-aware date handling
â”‚   â””â”€â”€ tripLoader.ts                 # NEW: Load individual trip JSON files
â””â”€â”€ data/
    â”œâ”€â”€ trips.json                    # DEPRECATED: Migrate to trips/ directory
    â””â”€â”€ trips/                        # NEW: Individual trip JSON files
        â”œâ”€â”€ 123e4567-....json         # One file per trip
        â”œâ”€â”€ 987f6543-....json
        â””â”€â”€ ...
```

**Structure Decision**: Web application (frontend only). Using existing Next.js App Router structure. All changes contained within `/frontend` directory. No backend modifications required. Data storage remains JSON files but migrates from single file to one-file-per-trip pattern for scalability (FR-003).

## Complexity Tracking

No constitution violations to justify. All principles satisfied.
